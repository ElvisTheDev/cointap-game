<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>SOLMAS</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
  <meta name="format-detection" content="telephone=no" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;800&display=swap" rel="stylesheet" />
  <style>
    :root{
      --fg: rgba(255,255,255,0.95);
      --fg-soft: rgba(255,255,255,0.75);
      --fg-dim: rgba(255,255,255,0.55);
      --glass: rgba(255,255,255,0.06);
      --glass-2: rgba(255,255,255,0.04);
      --stroke: rgba(255,255,255,0.14);
      --sol-purple: #9945FF;
      --sol-teal: #0ABDE3;
      --radius-lg: 16px;
      --radius-md: 12px;
      --nav-h: 58px;
      --safe-bottom: env(safe-area-inset-bottom, 0px);
    }
    *{ box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
    html,body{ height:100%; }
    body{
      margin:0; font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      color:var(--fg);
      background:
        radial-gradient(1200px 700px at 80% -10%, rgba(20,241,149,0.12), rgba(0,0,0,0)),
        radial-gradient(900px 500px at 0% 120%, rgba(153,69,255,0.14), rgba(0,0,0,0)),
        linear-gradient(180deg, #0b0b12 0%, #05060a 100%);
      background-attachment:fixed;
      overscroll-behavior:none;
      overflow:hidden;
      touch-action:manipulation;
    }
    .app{
      height: calc(100vh - var(--nav-h) - var(--safe-bottom) - 11px);
      max-width:980px; margin:0 auto; padding:10px 12px;
      display:flex; flex-direction:column; gap:8px; overflow:hidden;
    }
    header{ flex:0 0 auto; display:flex; align-items:center; justify-content:space-between; gap:10px; }
    #titleText{ font-size:20px; font-weight:800; letter-spacing:.2px; }

    .header-actions{ display:flex; align-items:center; gap:8px; }
    .buyBtn{
      background:linear-gradient(90deg, var(--sol-purple), var(--sol-teal));
      color:#fff; font-weight:800; text-shadow:0 0 2px #000, 0 0 2px #000;
      border:0; border-radius:12px; padding:10px 12px; font-size:13px; cursor:pointer;
    }

    .screens{ flex:1 1 auto; min-height:0; display:grid; }
    .screen{ display:none; grid-template-rows:auto 1fr auto; min-height:0; overflow:hidden; }
    .screen.active{ display:grid; }

    /* PLINKO layout */
    .plinko-wrap{ display:grid; grid-template-rows:auto 1fr auto; gap:8px; min-height:0; }
    .topBar{ display:flex; align-items:center; justify-content:space-between; gap:8px; }
    .balanceBox{ background:var(--glass); border:1px solid var(--stroke); border-radius:14px; padding:8px 12px; backdrop-filter:blur(4px); min-width:140px; text-align:center; }
    .balanceLabel{ font-size:12px; color:var(--fg-dim); }
    .balanceValue{ font-size:16px; font-weight:800; color:#fff; text-shadow:0 0 2px #000, 0 0 2px #000; }

    .canvasWrap{
      min-height:0; display:flex; align-items:center; justify-content:center;
      background:var(--glass-2); border:1px solid rgba(255,255,255,0.06); border-radius:var(--radius-lg); padding:8px;
    }
    #plinkoCanvas{ width:100%; height:52vh; display:block; }

    .actions{ display:flex; flex-direction:column; align-items:center; gap:6px; margin-top:-4px; }
    .primary{
      background:linear-gradient(90deg, var(--sol-purple), var(--sol-teal));
      color:#fff; font-weight:800; text-shadow:0 0 2px #000, 0 0 2px #000;
      border:0; border-radius:16px; padding:16px 24px; min-width:190px; font-size:16px; cursor:pointer;
    }

    /* bottom stats row (Balls + Regen) */
    .bottomStats{
      display:flex; gap:8px; justify-content:center; align-items:center; padding-top:2px;
    }
    .statChip{
      background:var(--glass); border:1px solid var(--stroke);
      border-radius:12px; padding:6px 10px; display:flex; align-items:center; gap:8px;
      font-size:12px; color:var(--fg-soft);
    }
    .statChip strong{ color:#fff; }

    .pad{ padding:4px 0; }
    #leaderboardList, #boostList, #socialList, #earnFriendsList, #inviteTopList{ display:flex; flex-direction:column; gap:5px; } /* 5px gap for Earn */

    .muted{ color:var(--fg-dim); }

    /* One-piece bottom menu bar (already lifted 5px) */
    .bottomNav{
      position:fixed; left:8px; right:8px; bottom:calc(11px + var(--safe-bottom));
      height:var(--nav-h);
      background:rgba(5,6,10,0.78); backdrop-filter:blur(6px);
      border:1px solid rgba(255,255,255,0.10); border-radius:14px;
      display:flex; align-items:center; justify-content:space-between; padding:6px 8px; gap:6px;
    }
    .nav-btn{
      flex:1 1 0; min-width:0;
      background:transparent; border:0; color:#fff; font-weight:800;
      border-radius:10px; padding:8px 6px;
      font-size:clamp(9px, 2.6vw, 11px);
      text-shadow:0 0 2px #000, 0 0 2px #000;
      display:inline-flex; align-items:center; justify-content:center; gap:6px;
      white-space:nowrap;
    }
    .nav-btn.active{ background:rgba(255,255,255,0.06); outline:1px solid rgba(153,69,255,0.35); }

    /* Bottom sheet (Buy Drops) */
    .sheet{
      position:fixed; left:0; right:0; bottom:0; height:70vh; max-height:520px;
      background:rgba(12,13,20,0.96); border-top-left-radius:16px; border-top-right-radius:16px;
      border:1px solid rgba(255,255,255,0.12);
      transform:translateY(100%); transition:transform 280ms ease;
      z-index:10000; display:flex; flex-direction:column;
      backdrop-filter:blur(8px);
    }
    .sheet.open{ transform:translateY(0%); }
    .sheetHeader{
      display:flex; align-items:center; justify-content:space-between;
      padding:12px 14px; border-bottom:1px solid rgba(255,255,255,0.09);
    }
    .sheetTitle{ font-weight:800; }
    .sheetClose{
      background:transparent; border:0; color:#fff; font-weight:800; font-size:16px; cursor:pointer;
    }
    .sheetBody{ padding:12px; overflow:auto; display:flex; flex-direction:column; gap:8px; }
    .sheetCard{
      background:rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.08);
      border-radius:14px; padding:12px; display:flex; align-items:center; justify-content:space-between;
    }

    /* Make only Boost and Earn screens scrollable */
    #screen-boost, #screen-earn{ overflow:auto; -webkit-overflow-scrolling:touch; }

    @media (max-width:420px){
      #plinkoCanvas{ height:48vh; }
    }
  </style>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
  <div class="app">
    <header>
      <div id="titleText">SOLMAS</div>
      <div class="header-actions">
        <button id="buyDropsBtn" class="buyBtn">Buy Drops</button>
      </div>
    </header>

    <section class="screens">
      <!-- ===== PLINKO ===== -->
      <div id="screen-plinko" class="screen active">
        <div class="plinko-wrap">

          <!-- TOP: Balance left, Buy Drops right (button above already) -->
          <div class="topBar">
            <div class="balanceBox" id="balanceBoxTop">
              <div class="balanceLabel">Balance</div>
              <div class="balanceValue" id="balance">0 SOLX</div>
            </div>
            <div style="flex:1"></div>
          </div>

          <div class="canvasWrap">
            <canvas id="plinkoCanvas" width="800" height="420"></canvas>
          </div>

          <div class="actions">
            <button id="dropBtn" class="primary">DROP</button>
            <!-- BOTTOM STATS: Balls + Regen timer -->
            <div class="bottomStats">
              <div class="statChip">Balls: <strong><span id="ballsCount">100</span>/<span id="ballsMax">100</span></strong></div>
              <div class="statChip">Regen in: <strong><span id="regenTimer">60s</span></strong></div>
            </div>
          </div>
        </div>
      </div>

      <!-- ===== BOOST ===== -->
      <div id="screen-boost" class="screen">
        <h3 style="margin:6px 0 4px; font-weight:800;">Get Your Boosters üöÄ</h3>
        <div id="boostList" class="pad"></div>
      </div>

      <!-- ===== TOP100 ===== -->
      <div id="screen-leaderboard" class="screen">
        <h3 style="margin:6px 0 4px; font-weight:800;">Top 100</h3>
        <div id="leaderboardList" class="pad"></div>
      </div>

      <!-- ===== SOCIAL ===== -->
      <div id="screen-social" class="screen">
        <h3 style="margin:6px 0 4px; font-weight:800;">Social Tasks</h3>
        <div id="socialList" class="pad">
          <div class="sheetCard"><div>üê¶ Follow on X/Twitter</div><button class="buyBtn" onclick="window.open('https://x.com/', '_blank')">Open</button></div>
          <div class="sheetCard"><div>üí¨ Join Telegram Channel</div><button class="buyBtn" onclick="window.open('https://t.me/', '_blank')">Open</button></div>
          <div class="sheetCard"><div>üì∫ Subscribe on YouTube</div><button class="buyBtn" onclick="window.open('https://youtube.com/', '_blank')">Open</button></div>
        </div>
      </div>

      <!-- ===== EARN (scrollable; compact + 5px gaps) ===== -->
      <div id="screen-earn" class="screen">
        <h3 style="margin:6px 0 8px; font-weight:800;">Earn üí∞</h3>

        <!-- Compact rewards info card -->
        <div class="sheetCard" style="padding:10px;">
          <div style="font-weight:700; font-size:13px; line-height:1.2;">
            üéÅ Both you and your friend will receive ü™ô 200 coins and ‚ö™ 100 ball drops.
          </div>
        </div>

        <!-- Separate box: referral link + copy -->
        <div class="sheetCard" style="gap:8px;">
          <input id="refLink" value="" placeholder="Your referral link‚Ä¶" style="flex:1; background:transparent; border:0; color:#fff; outline:none;">
          <button id="copyRef" class="buyBtn" style="min-width:96px;">Copy</button>
        </div>

        <!-- Friends invited -->
        <div class="sheetCard" style="flex-direction:column; align-items:stretch; gap:8px;">
          <div style="display:flex; justify-content:space-between; align-items:center;">
            <div style="font-weight:800;">Friends invited</div>
            <div id="invitedCount" style="font-weight:800;">0</div>
          </div>
          <div id="earnFriendsList" class="pad">
            <div class="muted">No friends yet ‚Äî share your link!</div>
          </div>
        </div>

        <!-- Top 100 invites -->
        <div class="sheetCard" style="flex-direction:column; align-items:stretch; gap:8px;">
          <div style="font-weight:800;">Top 100 by Invites</div>
          <div id="inviteTopList" class="pad">
            <div class="muted">No data yet.</div>
          </div>
        </div>
      </div>
    </section>
  </div>

  <!-- One-piece Bottom Menu -->
  <nav class="bottomNav">
    <button class="nav-btn active" data-target="plinko">ü™ô Plinko</button>
    <button class="nav-btn" data-target="boost">üöÄ Boost</button>
    <button class="nav-btn" data-target="leaderboard">üèÜ Top100</button>
    <button class="nav-btn" data-target="social">üåê Social</button>
    <button class="nav-btn" data-target="earn">üí∞ Earn</button>
  </nav>

  <!-- Bottom sheet: Buy Drops -->
  <div id="buySheet" class="sheet" aria-hidden="true">
    <div class="sheetHeader">
      <div class="sheetTitle">Buy Drops</div>
      <button id="sheetClose" class="sheetClose">‚úï</button>
    </div>
    <div class="sheetBody">
      <div class="sheetCard">
        <div>üéØ 100 drops</div>
        <button class="buyBtn" onclick="window.appBuyDrops(100)">Buy</button>
      </div>
      <div class="sheetCard">
        <div>üí† 300 drops</div>
        <button class="buyBtn" onclick="window.appBuyDrops(300)">Buy</button>
      </div>
      <div class="sheetCard">
        <div>üöÄ 1000 drops</div>
        <button class="buyBtn" onclick="window.appBuyDrops(1000)">Buy</button>
      </div>
      <div class="muted" style="font-size:12px;">(Hook these buttons to your payment flow / Telegram Stars later.)</div>
    </div>
  </div>

  <!-- Double-tap zoom guard -->
  <script>
    (function(){
      let lastTouchEnd = 0;
      document.addEventListener('touchend', function (event) {
        const now = Date.now();
        if (now - lastTouchEnd <= 300) { event.preventDefault(); }
        lastTouchEnd = now;
      }, { passive: false });
    })();
  </script>

  <script src="/app.js"></script>
</body>
</html>
